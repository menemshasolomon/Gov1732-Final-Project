---
title: "County Level Data"
output: pdf_document
date: "2025-11-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(broom)
library(ggplot2)
library(stringr) 
library(readr) 
library(tigris)
library(sf)
library(ggplot2)
library(patchwork)
library(purrr)
library(glmnet)
library(janitor)
library(tidyr)
library(knitr)
library(kableExtra)

```

## Load in election data and clean


```{r}
props <- read_csv("Ohio Ballot Issues 2023 copy.csv")

props <- props[-c(1:3), ]

colnames(props) <- c(
"County Name", "Precinct Name", "Precinct Code", "Region Name", "Media Market", "Registered Voters", "Ballots Counted", "Official Voter Turnout", "abortion_yes", "abortion_no", "weed_yes", "weed_no"
)

props_county <- props |>
  mutate(across(
    c("Registered Voters", "Ballots Counted",
      "abortion_yes", "abortion_no", "weed_yes", "weed_no"),
    ~ readr::parse_number(as.character(.x))
  )) |>
  group_by(`County Name`) |>
  summarise(
    `Registered Voters` = sum(`Registered Voters`, na.rm = TRUE),
    `Ballots Counted`   = sum(`Ballots Counted`, na.rm = TRUE),
    abortion_yes        = sum(abortion_yes, na.rm = TRUE),
    abortion_no         = sum(abortion_no, na.rm = TRUE),
    weed_yes            = sum(weed_yes, na.rm = TRUE),
    weed_no             = sum(weed_no, na.rm = TRUE)
  )

props_county <- props_county |>
  mutate(voter_turnout = (`Ballots Counted`/`Registered Voters`) * 100,
         abortion_diff = abortion_yes - abortion_no, 
         abortion_turnout = abortion_yes + abortion_no,
         abortion_pct = (abortion_yes / abortion_turnout) * 100,
         weed_diff = weed_yes - weed_no, 
         weed_turnout = weed_yes + weed_no,
         weed_pct = (weed_yes / weed_turnout) * 100,
         abortion_weed_diff = abortion_diff - weed_diff,
         prop_turnout_diff = abortion_turnout - weed_turnout,
         prop_turnout_diff_pct = (prop_turnout_diff / `Ballots Counted`) *100,
         abortion_margin = (abortion_diff / abortion_turnout) * 100, 
         weed_margin = (weed_diff / weed_turnout) * 100, 
         diff_margin = (abortion_weed_diff / `Ballots Counted`) * 100,
         across(c(abortion_margin, weed_margin, diff_margin), ~ round(.x, 2)))

```


# Load in shapefile data 

```{r}
ohio_sf <- st_read("ohio_county_level.shp")

ohio_prop_map_df <- ohio_sf |>
  left_join(props_county, by = c("NAME" = "County Name"))
```


# First Map!

```{r}
ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = diff_margin), color = NA) + scale_fill_gradient2(
    low = "forestgreen",
    mid = "white",
    high = "darkviolet",
    midpoint = 0,
name = "Abortion – Weed\nMargin (pp)" )+
labs(
title = "Ohio County-Level Disparities\nAbortion vs. Marijuana Ballot Margins (2023)",
caption = "Positive = More support for abortion than weed") + 
  theme_minimal() + 
  theme(panel.grid = element_blank(),
    legend.position = "right"
  )

ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = abortion_pct), color = NA) + scale_fill_gradient2(
    low = "white",
    mid = "lightpink",
    high = "darkviolet",
    midpoint = 50,
name = "Yes on Abortion (pp)" )+
labs(
title = "Ohio County-Level Vote in Favor of Abortion Legalization (2023)") + 
  theme_minimal() + 
  theme(panel.grid = element_blank(),
    legend.position = "right"
  )

ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = weed_pct), color = NA) + scale_fill_gradient2(
    low = "white",
    mid = "lightgreen",
    high = "forestgreen",
    midpoint = 50,
name = "Yes on Marijuana Legalization (pp)" )+
labs(
title = "Ohio County-Level Vote in Favor of Marijuana Legalization (2023)") + 
  theme_minimal() + 
  theme(panel.grid = element_blank(),
    legend.position = "right"
  )
```

```{r}
ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = prop_turnout_diff_pct), color = NA) + scale_fill_gradient2(
    low = "forestgreen",
    mid = "white",
    high = "darkviolet",
    midpoint = 0,
name = "Abortion – Marijuana\nMargin (pp)" )+
labs(
title = "Ohio County-Level Turnout Disparities\nAbortion vs. Marijuana  (2023)",
caption = "Positive = More turnout for abortion than marijuana") + 
  theme_minimal() + 
  theme(panel.grid = element_blank(),
    legend.position = "right"
  )
```

```{r}
ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = voter_turnout), color = NA) + scale_fill_gradient2(
    low = "white",
    mid = "yellow1",
    high = "orange",
    midpoint = 50,
name = "Turnout (%)" )+
labs(
title = "Ohio County-Level Turnout (2023)") + 
  theme_minimal() + 
  theme(panel.grid = element_blank(),
    legend.position = "right"
  )
```


```{r}
ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = abortion_margin), color = NA) + scale_fill_gradient2(
    low = "#800000",
    high = "#002B84",
    midpoint = 0,
    name = "Abortion Margin (pp)"
)+ labs(
title = "Ohio Abortion Referendum (2023)" )+
theme_minimal() + theme(
panel.grid = element_blank(),
    legend.position = "right"
  )
```

```{r}
ggplot(ohio_prop_map_df) +
geom_sf(aes(fill = weed_margin), color = NA) + scale_fill_gradient2(
    low = "#800000",
    high = "#002B84",
    midpoint = 0,
    name = "Marijuana Margin (pp)"
)+ labs(
title = "Ohio Marijuana Referendum (2023)" )+
theme_minimal() + theme(
panel.grid = element_blank(),
    legend.position = "right"
  )
```

## Looking at census data

```{r}

age_raw <- read_csv("AgeRace.csv", show_col_types = FALSE)
meta_raw <- read_csv("ACSDP5Y2023.DP05-Column-Metadata.csv", show_col_types = FALSE)

age_raw <- age_raw[-1, ]

estimate_cols <- names(age_raw)[str_detect(names(age_raw), "DP\\d{2}_.+E$")]
id_cols <- intersect(c("GEO_ID", "NAME"), names(age_raw))

age_est <- age_raw |>
  select(all_of(id_cols), all_of(estimate_cols))

rename_map <- meta_raw |>
  clean_names() |>
  transmute(
    var = column_name,
    label = label
  ) |>
  filter(str_detect(var, "DP\\d{2}_.+E$")) |>
  mutate(
    label = label |>
      str_replace_all("(?i)^Estimate!!", "") |>
      str_replace_all("!!", " / ") |>
      str_replace_all("[^A-Za-z0-9/ &-]+", " ") |>
      str_squish(),
    new_name = label |>
      str_to_lower() |>
      str_replace_all("/", " ") |>
      str_replace_all("&", "and") |>
      str_replace_all("-", " ") |>
      str_replace_all("\\s+", "_")
  ) |>
  select(var, new_name) |>
  distinct()

rename_map <- rename_map |>
  filter(str_detect(new_name, "percent"))

rename_map_keep <- rename_map |>
  filter(var %in% names(age_est)) |>
  mutate(new_name = make.unique(new_name, sep = "_"))

keep_vars <- c(id_cols, rename_map_keep$var)
valid_map <- setNames(rename_map_keep$var, rename_map_keep$new_name)

age_clean <- age_est |>
  select(all_of(keep_vars)) |>               # only keep id + percent vars
  rename(!!!valid_map) |>
  mutate(
    NAME = str_squish(NAME),
    county = NAME |>
      str_replace(",\\s*Ohio$", "") |>
      str_replace("\\s*County$", "") |>
      str_to_title()
  ) |>
  relocate(county, .after = NAME)

age_clean <- age_clean |>
  mutate(across(all_of(names(valid_map)), ~ as.numeric(.x)))

age_clean_selective <- age_clean |>
  select(county, percent_sex_and_age_total_population, percent_sex_and_age_total_population_male, percent_sex_and_age_total_population_female, percent_sex_and_age_total_population_under_5_years, percent_sex_and_age_total_population_5_to_9_years, percent_sex_and_age_total_population_10_to_14_years, percent_sex_and_age_total_population_15_to_19_years, percent_sex_and_age_total_population_20_to_24_years, percent_sex_and_age_total_population_25_to_34_years, percent_sex_and_age_total_population_35_to_44_years, percent_sex_and_age_total_population_45_to_54_years, percent_sex_and_age_total_population_55_to_59_years, percent_sex_and_age_total_population_60_to_64_years, percent_sex_and_age_total_population_65_to_74_years, percent_sex_and_age_total_population_75_to_84_years, percent_sex_and_age_total_population_85_years_and_over) |>
  rename(
    pct_total_pop = percent_sex_and_age_total_population,
    pct_male = percent_sex_and_age_total_population_male,
    pct_female = percent_sex_and_age_total_population_female,
    pct_under5 = percent_sex_and_age_total_population_under_5_years,
    pct_5_9 = percent_sex_and_age_total_population_5_to_9_years,
    pct_10_14 = percent_sex_and_age_total_population_10_to_14_years,
    pct_15_19 = percent_sex_and_age_total_population_15_to_19_years,
    pct_20_24 = percent_sex_and_age_total_population_20_to_24_years,
    pct_25_34 = percent_sex_and_age_total_population_25_to_34_years,
    pct_35_44 = percent_sex_and_age_total_population_35_to_44_years,
    pct_45_54 = percent_sex_and_age_total_population_45_to_54_years,
    pct_55_59 = percent_sex_and_age_total_population_55_to_59_years,
    pct_60_64 = percent_sex_and_age_total_population_60_to_64_years,
    pct_65_74 = percent_sex_and_age_total_population_65_to_74_years,
    pct_75_84 = percent_sex_and_age_total_population_75_to_84_years,
    pct_85plus = percent_sex_and_age_total_population_85_years_and_over
  )

race_clean <- age_clean |>
  select(county, percent_race_total_population_one_race, percent_race_total_population_one_race_white, percent_race_total_population_one_race_black_or_african_american, percent_race_total_population_one_race_american_indian_and_alaska_native, percent_race_total_population_one_race_asian, percent_race_total_population_one_race_native_hawaiian_and_other_pacific_islander, percent_hispanic_or_latino_and_race_total_population_hispanic_or_latino_of_any_race) |>
  rename(
    pct_one_race = percent_race_total_population_one_race,
    pct_white = percent_race_total_population_one_race_white,
    pct_black = percent_race_total_population_one_race_black_or_african_american,
    pct_native_american = percent_race_total_population_one_race_american_indian_and_alaska_native,
    pct_asian = percent_race_total_population_one_race_asian,
    pct_pacific_islander = percent_race_total_population_one_race_native_hawaiian_and_other_pacific_islander,
    pct_hispanic = percent_hispanic_or_latino_and_race_total_population_hispanic_or_latino_of_any_race
  )



```

##Merge age and race data with existing data

```{r}
ohio_joined_age <- ohio_prop_map_df |>
  left_join(
    age_clean_selective,
    by = c("NAME" = "county")
  )

ohio_joined_race <- ohio_joined_age |>
  left_join(
    race_clean,
    by = c("NAME" = "county")
  )
```


```{r}
edu_raw <- read_csv("EduAttain.csv", col_names = FALSE, show_col_types = FALSE)

new_names <- edu_raw %>%
  slice(2) %>%
  unlist() %>%
  as.character()

edu <- edu_raw %>%
  slice(-c(1, 2))     # remove first two rows
colnames(edu) <- new_names

nm <- names(edu)
nm <- replace_na(nm, "")

estimate_cols2 <- nm[str_detect(nm, regex("Estimate!!Total!!", ignore_case = TRUE))]

id_candidates <- c("Geographic Area Name")
id_cols2 <- intersect(id_candidates, nm)

edu_estimate <- edu %>%
  select(any_of(id_cols2), all_of(estimate_cols2))

nm2 <- names(edu_estimate)
nm2 <- replace_na(nm2, "")

estimate_cols3 <- nm2[str_detect(nm2, regex("AGE BY EDUCATIONAL ATTAINMENT", ignore_case = TRUE))]

edu_estimate2 <- edu_estimate %>%
  select(any_of(id_cols2), all_of(estimate_cols3))

# 4) Clean county name; optionally keep only county rows
edu_estimate2 <- edu_estimate2 %>%
  mutate(
    `Geographic Area Name` = str_squish(`Geographic Area Name`),
    county = `Geographic Area Name` %>%
      str_replace(",\\s*Ohio$", "") %>%
      str_replace("\\s*County$", "") %>%
      str_squish() %>%
      str_to_title()
  ) %>%
  relocate(county, .after = `Geographic Area Name`)

edu_totals <- edu_estimate2 %>%
  mutate(across(
    contains("Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT"),
    ~ readr::parse_number(as.character(.x))
  )) %>%
  mutate(
    pop_18_24      = `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 18 to 24 years`,
    pop_25plus     = `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over`,
    pop_18plus     = pop_18_24 + pop_25plus,

    lt_hs_18plus   = `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 18 to 24 years!!Less than high school graduate` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!Less than 9th grade` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!9th to 12th grade, no diploma`,

    hs_grad_18plus = `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 18 to 24 years!!High school graduate (includes equivalency)` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!High school graduate (includes equivalency)`,

    some_coll_18plus =
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 18 to 24 years!!Some college or associate's degree` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!Some college, no degree` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!Associate's degree`,

    ba_plus_18plus = `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 18 to 24 years!!Bachelor's degree or higher` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!Bachelor's degree` +
                     `Estimate!!Total!!AGE BY EDUCATIONAL ATTAINMENT!!Population 25 years and over!!Graduate or professional degree` ) %>%


  select(
    county,
    pop_18_24, pop_25plus, pop_18plus,
    lt_hs_18plus, hs_grad_18plus, some_coll_18plus, ba_plus_18plus
  )
```

```{r}
inc_raw <- read_csv("Incomes_2.csv", show_col_types = FALSE) %>%
  as_tibble()

ohio_joined_race <- ohio_joined_race %>%
  left_join(inc_raw, by = "NAME")

```

```{r}
ohio_joined_race <- ohio_joined_race %>%
  left_join(edu_totals, by = c("NAME" = "county"))
```


```{r}
ohio_joined_race <- ohio_joined_race %>%
  mutate(`2022_BFA_Percap_Income` = as.numeric(`2022_BFA_Percap_Income`))
```

```{r}
gender_range <- range(
  c(ohio_joined_race$pct_male, ohio_joined_race$pct_female),
  na.rm = TRUE
)

male_map <- ggplot(ohio_joined_race) +
  geom_sf(aes(fill = pct_male), color = NA) +
  scale_fill_gradient(
    low  = "white",
    high = "steelblue",
    limits = gender_range,
    name = "Percent Male"
  ) +
  labs(title = "Ohio Gender: Male (2023)") +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        legend.position = "none")

female_map <- ggplot(ohio_joined_race) +
  geom_sf(aes(fill = pct_female), color = NA) +
  scale_fill_gradient(
    low  = "white",
    high = "tomato",
    limits = gender_range,
    name = "Percent Female"
  ) +
  labs(title = "Ohio Gender: Female (2023)") +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        legend.position = "none")

male_map + female_map

```

```{r}
race_cols <- c(
  "pct_one_race",
  "pct_white",
  "pct_black",
  "pct_native_american",
  "pct_asian",
  "pct_pacific_islander",
  "pct_hispanic"
)

race_labels <- c(
  "One Race",
  "White",
  "Black",
  "Native American",
  "Asian",
  "Pacific Islander",
  "Hispanic"
)

race_colors <- c(
  "grey40",   # one race (homogeneity)
  "blue",     # white
  "orange",   # black
  "red3",     # Native American
  "purple",   # Asian
  "darkgreen",# Pacific Islander
  "maroon"    # Hispanic
)

make_race_map <- function(col, label, color) {
  ggplot(ohio_joined_race) +
    geom_sf(aes(fill = .data[[col]]), color = NA) +
    scale_fill_gradient(
      low  = "white",
      high = color,
      name = paste0("Percent ", label)
    ) +
    labs(
      title = paste0("Ohio Race: ", label)
    ) +
    theme_minimal() +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",
      plot.title = element_text(size = 11, face = "bold")
    )
}

race_plots <- pmap(
  list(col = race_cols, label = race_labels, color = race_colors),
  make_race_map
)

race_grid <- wrap_plots(race_plots, ncol = 3)
race_grid

```
```{r}
age_cols <- c(
  "pct_5_9", "pct_10_14", "pct_15_19", "pct_20_24",
  "pct_25_34", "pct_35_44", "pct_45_54", "pct_55_59",
  "pct_60_64", "pct_65_74", "pct_75_84"
)

age_labels <- c(
  "5–9", "10–14", "15–19", "20–24",
  "25–34", "35–44", "45–54", "55–59",
  "60–64", "65–74", "75–84"
)

make_age_map <- function(col, label) {
  ggplot(ohio_joined_race) +
    geom_sf(aes(fill = .data[[col]]), color = NA) +
    scale_fill_gradient(
      low = "white",
      high = "orange",
      name = paste0("Percent Age ", label)
    ) +
    labs(
      title = paste0("Age ", label)
    ) +
    theme_minimal() +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",   # remove individual legends for cleaner grid
      plot.title = element_text(size = 12, face = "bold")
    )
}

plots <- map2(age_cols, age_labels, make_age_map)

grid <- wrap_plots(plots, ncol = 4)

grid

```
```{r}
ohio_joined_race <- ohio_joined_race |>
  mutate(pct_lt_hs_18plus      = 100 * lt_hs_18plus      / pop_18plus,
pct_hs_grad_18plus    = 100 * hs_grad_18plus    / pop_18plus,
pct_some_coll_18plus  = 100 * some_coll_18plus  / pop_18plus,
pct_ba_plus_18plus    = 100 * ba_plus_18plus    / pop_18plus)

edu_cols <- c(
  "pct_lt_hs_18plus",
  "pct_hs_grad_18plus",
  "pct_some_coll_18plus",
  "pct_ba_plus_18plus"
)

edu_labels <- c(
  "< High School",
  "High School Grad",
  "Some College",
  "BA or Higher"
)

edu_colors <- c(
  "firebrick",
  "goldenrod",
  "dodgerblue3",
  "darkgreen"
)

make_edu_map <- function(col, label, color) {
  ggplot(ohio_joined_race) +
    geom_sf(aes(fill = .data[[col]]), color = NA) +
    scale_fill_gradient(
      low  = "white",
      high = color,
      name = paste0(label, " (18+)")
    ) +
    labs(
      title = paste0("Ohio Education: ", label, " (18+)")
    ) +
    theme_minimal() +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",
      plot.title = element_text(size = 11, face = "bold")
    )
}

edu_plots <- pmap(
  list(col = edu_cols, label = edu_labels, color = edu_colors),
  make_edu_map
)

edu_grid <- wrap_plots(edu_plots, ncol = 2)
edu_grid

```


```{r}
ggplot(ohio_joined_race) +
geom_sf(aes(fill = `2022_BFA_Percap_Income`), color = NA) + scale_fill_gradient2(
    low = "white",
    high = "forestgreen",
    midpoint = min(ohio_joined_race$`2022_BFA_Percap_Income`, na.rm = TRUE),
    name = "2022 BEA Income per Capita by County"
)+ labs(
title = "Ohio Per-Capita Personal Income (2023)" )+
theme_minimal() + theme(
panel.grid = element_blank(),
    legend.position = "right"
  )
```

```{r}
ohio_joined_race <- ohio_joined_race |>
  mutate(non_white_pop = pct_one_race - pct_white)


ohio_joined_race_2 <- ohio_joined_race |>
  rename(inc_2022_BEA_Percap = `2022_BFA_Percap_Income`) |>
  mutate(pct_20_44 = pct_20_24 + pct_25_34 + pct_35_44,
         pct_60_84 = pct_60_64 + pct_65_74 + pct_75_84)



model_abortion_pct <- lm(
  abortion_pct ~ 
    pct_female +
    pct_20_44 +
    pct_60_84 +
    non_white_pop +
    inc_2022_BEA_Percap +
    pct_ba_plus_18plus,
  data = ohio_joined_race_2,
  weights = `Registered Voters`
)

summary(model_abortion_pct)

```

```{r}
coef_df_abortion <- tidy(model_abortion_pct, conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%    
  mutate(term = reorder(term, estimate)) # order by coefficient size

ggplot(coef_df_abortion, aes(x = estimate, y = term)) +
  geom_point(size = 3, color = "firebrick") +
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  labs(
    title = "Coefficient Estimates with 95% Confidence Intervals",
    x = "Coefficient Estimate",
    y = "Predictor"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )

```


```{r}
predictors <- c(
  "pct_female",
    "pct_20_44",
    "pct_60_84",
    "non_white_pop",
    "inc_2022_BEA_Percap",
    "pct_ba_plus_18plus")


dat <- ohio_joined_race_2 %>% st_drop_geometry()

X <- as.matrix(dat[, predictors])
y <- dat$abortion_pct
w <- dat$`Registered Voters`

set.seed(123)
cv_abortion <- cv.glmnet(
  x = X,
  y = y,
  alpha = 0.5,
  nfolds = 10,
  weights = w,         
  standardize = TRUE
)

coef_abortion <- coef(cv_abortion, s = "lambda.min")
coef_abortion

lambda_min_abortion <- cv_abortion$lambda.min
lambda_1se_abortion <- cv_abortion$lambda.1se

```


```{r}
# Model 2: Marijuana % support
model_weed_pct <- lm(
  weed_pct ~ 
    pct_female +
    pct_20_44 +
    pct_60_84 +
    non_white_pop +
    inc_2022_BEA_Percap +
    pct_ba_plus_18plus,
  data = ohio_joined_race_2,
  weights = `Registered Voters`
)

summary(model_weed_pct)
```
```{r}
coef_df_weed <- tidy(model_weed_pct, conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%    
  mutate(term = reorder(term, estimate)) # order by coefficient size

ggplot(coef_df_weed, aes(x = estimate, y = term)) +
  geom_point(size = 3, color = "firebrick") +
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  labs(
    title = "Coefficient Estimates with 95% Confidence Intervals",
    x = "Coefficient Estimate",
    y = "Predictor"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )
```


```{r}
y <- dat$weed_pct

cv_weed <- cv.glmnet(
  X, y,
  alpha = 0.5,
  nfolds = 10,
  weights = w,
  standardize = TRUE
)

lambda_min_weed <- cv_weed$lambda.min
lambda_1se_weed <- cv_weed$lambda.1se
coef_weed <- coef(cv_weed, s = "lambda.min")
coef_weed

```


```{r}
model_diff_margin <- lm(
  diff_margin ~ 
    pct_female +
    pct_20_44 +
    pct_60_84 +
    non_white_pop +
    inc_2022_BEA_Percap +
    pct_ba_plus_18plus,
  data = ohio_joined_race_2,
  weights = `Registered Voters`
)

summary(model_diff_margin)

```

```{r}
coef_df_margin <- tidy(model_diff_margin, conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%    
  mutate(term = reorder(term, estimate)) # order by coefficient size

ggplot(coef_df_margin, aes(x = estimate, y = term)) +
  geom_point(size = 3, color = "firebrick") +
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  labs(
    title = "Coefficient Estimates with 95% Confidence Intervals",
    x = "Coefficient Estimate",
    y = "Predictor"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )
```


```{r}
y <- dat$diff_margin

cv_diff <- cv.glmnet(
  X, y,
  alpha = 0.5,
  nfolds = 10,
  weights = w,
  standardize = TRUE
)

lambda_min_diff <- cv_diff$lambda.min
lambda_1se_diff <- cv_diff$lambda.1se
coef_diff <- coef(cv_diff, s = "lambda.min")
coef_diff
```


```{r}
model_turnout_diff <- lm(
  prop_turnout_diff_pct ~ 
    pct_female +
    pct_20_44 +
    pct_60_84 +
    non_white_pop +
    inc_2022_BEA_Percap +
    pct_ba_plus_18plus,
  data = ohio_joined_race_2,
  weights = `Registered Voters`
)

summary(model_turnout_diff)

```

```{r}
coef_df_turnout <- tidy(model_turnout_diff, conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%    
  mutate(term = reorder(term, estimate)) # order by coefficient size

ggplot(coef_df_turnout, aes(x = estimate, y = term)) +
  geom_point(size = 3, color = "firebrick") +
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  labs(
    title = "Coefficient Estimates with 95% Confidence Intervals",
    x = "Coefficient Estimate",
    y = "Predictor"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )
```


```{r}
y <- dat$prop_turnout_diff_pct

cv_turnout <- cv.glmnet(
  X, y,
  alpha = 0.5,
  nfolds = 10,
  weights = w,
  standardize = TRUE
)


lambda_min_turnout <- cv_turnout$lambda.min
lambda_1se_turnout <- cv_turnout$lambda.1se
coef_turnout <- coef(cv_turnout, s = "lambda.min")
coef_turnout
```

```{r}
coef_table <- list(
  abortion_pct      = coef_abortion,
  weed_pct          = coef_weed,
  diff_margin       = coef_diff,
  turnout_diff_pct  = coef_turnout
) %>%
  map(~ as.matrix(.x)) %>%
  map(~ data.frame(
    term = rownames(.x),
    coef = .x[,1],
    row.names = NULL
  )) %>%
  bind_rows(.id = "model") %>%
  pivot_wider(
    names_from = model,
    values_from = coef
  ) %>%
  mutate(across(where(is.numeric), ~ round(.x, 4)))

coef_table %>%
  kbl(caption = "Elastic Net Coefficients at λ_min") %>%
  kable_paper(full_width = FALSE)


lambda_table <- tibble(
  model = c("abortion_pct", "weed_pct", "diff_margin", "turnout_diff_pct"),
  lambda_min = c(lambda_min_abortion, lambda_min_weed, lambda_min_diff, lambda_min_turnout),
  lambda_1se = c(lambda_1se_abortion, lambda_1se_weed, lambda_1se_diff, lambda_1se_turnout)
)

lambda_table %>%
  kbl(caption = "Elastic Net Optimal Lambda Values") %>%
  kable_paper(full_width = FALSE)

```

```{r}

plot(cv_abortion$glmnet.fit, xvar = "lambda", label = TRUE)
title("Coefficient Paths: Abortion %", line = 2.5)

plot(cv_weed$glmnet.fit, xvar = "lambda", label = TRUE)
title("Coefficient Paths: Weed %", line = 2.5)

plot(cv_diff$glmnet.fit, xvar = "lambda", label = TRUE)
title("Coefficient Paths: Diff Margin", line = 2.5)

plot(cv_turnout$glmnet.fit, xvar = "lambda", label = TRUE)
title("Coefficient Paths: Turnout Difference %", line = 2.5)

```


```{r}
disparity_plot <- ggplot(data = ohio_joined_race, aes(x = pct_white, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    x = "Percentage White Non-Hispanic",
    y = "Difference in Referendum Margin (Abortion - Weed)",
    title = "County-Level Disparities in Ohio 2023 Mid Year Referenda Margins",
    subtitle = "By Percentage White Non-Hispanic"
  )

disparity_plot
```
```{r}
turnout_disparity_plot <- ggplot(data = ohio_joined_race, aes(x = voter_turnout, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    x = "Voter Turnout (County Level)",
    y = "Difference in Referendum Margin (Abortion - Weed)",
    title = "County-Level Disparities in Ohio 2023 Mid Year Referenda Margins",
    subtitle = "By County Level Turnout"
  )

turnout_disparity_plot
```
```{r}
abortion_income_plot <- ggplot(data = ohio_joined_race, aes(x = `2022_BFA_Percap_Income`, y = abortion_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    x = "Median Income (County Level)",
    y = "Abortion Referendum Margin",
    title = "Income versus Abortion Margin"
  )

abortion_income_plot

weed_income_plot <- ggplot(data = ohio_joined_race, aes(x = `2022_BFA_Percap_Income`, y = weed_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    x = "Median Income (County Level)",
    y = "Marijuana Referendum Margin",
    title = "Income versus Marijuana Margin"
  )

weed_income_plot
```


```{r}
# Chat GPT helped me generate this helper function to add R^2 and equation to the graphs

add_lm_labels <- function(df, xvar, yvar) {
  
  # build formula safely as text
  fm <- as.formula(paste(yvar, "~", xvar))
  
  # fit model
  m <- lm(fm, data = df)
  
  # extract coefficients + R²  
  eq  <- sprintf("y = %.3f + %.3f x", coef(m)[1], coef(m)[2])
  r2  <- sprintf("R² = %.3f", summary(m)$r.squared)
  
  list(eq = eq, r2 = r2)
}

```

```{r}
labels <- add_lm_labels(ohio_joined_race, "pct_white", "diff_margin")

ggplot(ohio_joined_race, aes(x = pct_white, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% White (non-Hispanic)",
    y = "Abortion - Weed Margin (pp)",
    title = "Counties with a Larger White Population Lean More Pro-Abortion than Pro-Weed",
    subtitle = "Bivariate relationship with linear trend"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race, "pct_black", "diff_margin")

ggplot(ohio_joined_race, aes(x = pct_black, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Black (non-Hispanic)",
    y = "Abortion - Weed Margin (pp)",
    title = "Counties with a Larger Black Populations Lean More Pro-Weed than Pro-Abortion",
    subtitle = "Bivariate relationship with linear trend"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race, "non_white_pop", "diff_margin")

ggplot(ohio_joined_race, aes(x = non_white_pop, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Non-White",
    y = "Abortion - Weed Margin (pp)",
    title = "Counties with a Larger Non-White Populations Lean More Pro-Weed than Pro-Abortion",
    subtitle = "Bivariate relationship with linear trend"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race, "non_white_pop", "weed_pct")

ggplot(ohio_joined_race, aes(x = non_white_pop, y = weed_pct)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Non-White",
    y = "Weed Yes (pp)",
    title = "Counties with a Larger Non-White Populations Lean More Pro-Weed",
    subtitle = "Bivariate relationship with linear trend"
  ) +
  theme_minimal()
```


```{r}
labels <- add_lm_labels(ohio_joined_race, "pct_ba_plus_18plus", "diff_margin")

ggplot(ohio_joined_race, aes(x = pct_ba_plus_18plus, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "darkgreen") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% BA or Higher (Age 18+)",
    y = "Abortion - Weed Margin",
    title = "Counties with Higher Education Levels Lean More Pro-Abortion than Pro-Weed"
  ) +
  theme_minimal()

```

```{r}
labels <- add_lm_labels(ohio_joined_race_2, "inc_2022_BEA_Percap", "diff_margin")

ggplot(ohio_joined_race_2, aes(x = inc_2022_BEA_Percap, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "purple") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "Per Capita Income (2022)",
    y = "Difference in Margin (Abortion - Weed)",
    title = "Higher Income Counties Show Larger Pro-Abortion Margins"
  ) +
  theme_minimal()
```

```{r}
labels <- add_lm_labels(ohio_joined_race_2, "pct_female", "diff_margin")

ggplot(ohio_joined_race_2, aes(x = pct_female, y = diff_margin)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "magenta") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Female",
    y = "Difference in Margin (Abortion - Weed)",
    title = "H1a: Counties with a Larger Female Populations Lean More 
    Pro-Abortion than Pro-Marijuana"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race_2, "pct_female", "abortion_pct")

ggplot(ohio_joined_race_2, aes(x = pct_female, y = abortion_pct)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "magenta") +
  annotate("text", x = Inf, y = Inf, label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Female",
    y = "Yes on Issue 1, Abortion (pp)",
    title = "H1a: Counties with a Larger Female Populations Have a Higher 
    Levels of Support for Issue 1 (Abortion)"
  ) +
  theme_minimal()
```

```{r}
ohio_joined_race_3 <- ohio_joined_race_2 |>
  mutate(pct_20_44 = pct_20_24 + pct_25_34 + pct_35_44,
         pct_60_84 = pct_60_64 + pct_65_74 + pct_75_84)

labels <- add_lm_labels(ohio_joined_race_3, "pct_20_44", "weed_pct")

ggplot(ohio_joined_race_3, aes(x = pct_20_44, y = weed_pct)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "forestgreen") +
  annotate("text", x = Inf, y = Inf, 
           label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Aged 20–44",
    y = "Weed Yes Vote %",
    title = "Counties with Younger Populations Show Higher Marijuana Support",
    subtitle = "Youth-heavy counties overwhelmingly favor legalization"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race_3, "pct_20_44", "abortion_pct")

ggplot(ohio_joined_race_3, aes(x = pct_20_44, y = abortion_pct)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "darkviolet") +
  annotate("text", x = Inf, y = Inf, 
           label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Aged 20–44",
    y = "Abortion Yes Vote %",
    title = "Counties with Younger Populations Show Higher Abortion Support",
    subtitle = "Youth-heavy counties overwhelmingly favor legalization"
  ) +
  theme_minimal()

labels <- add_lm_labels(ohio_joined_race_3, "pct_60_84", "weed_pct")

ggplot(ohio_joined_race_3, aes(x = pct_60_84, y = weed_pct)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = TRUE, color = "darkred") +
  annotate("text", x = Inf, y = Inf, 
           label = paste(labels$eq, labels$r2, sep="\n"),
           hjust = 1.1, vjust = 1.2, size = 4) +
  labs(
    x = "% Aged 60–84",
    y = "Weed Yes Vote %",
    title = "Older Counties Are Less Supportive of Marijuana Legalization",
    subtitle = "Support declines as older populations increase"
  ) +
  theme_minimal()
```

```{r}
library(scales)

vars <- c(
  abortion_pct = "Abortion support (Issue 1), % Yes",
  weed_pct     = "Marijuana support (Issue 2), % Yes",
  diff_margin  = "Vote margin difference (Issue 1 − Issue 2), pp",
  prop_turnout_diff_pct = "Turnout difference (Issue 1 − Issue 2), votes",
  pct_female   = "Percent female",
  pct_20_44    = "Percent ages 20–44",
  pct_60_84    = "Percent ages 60–84",
  non_white_pop = "Percent non-white",
  inc_2022_BEA_Percap       = "Per capita income (USD)",
  pct_ba_plus_18plus  = "Bachelor’s degree or higher (18+), %"
)

nogeo <- st_drop_geometry(ohio_joined_race_2)

tab_A1 <- nogeo %>%
  summarise(across(
    all_of(names(vars)),
    list(
      Mean = ~mean(.x, na.rm = TRUE),
      SD   = ~sd(.x, na.rm = TRUE),
      Min  = ~min(.x, na.rm = TRUE),
      Max  = ~max(.x, na.rm = TRUE)
    ),
    .names = "{.col}__{.fn}"   # << key change
  )) %>%
  pivot_longer(
    cols = everything(),
    names_to = c("var", "stat"),
    names_sep = "__",         # << key change
    values_to = "value"
  ) %>%
  pivot_wider(names_from = stat, values_from = value) %>%
  mutate(Variable = unname(vars[var])) %>%
  select(Variable, Mean, SD, Min, Max)

tab_A1

knitr::kable(tab_A1, caption = "Table A1. Summary Statistics for Key Variables (Ohio Counties, 2023)")

```

```{r}
library(weights)

wtd.cor(ohio_joined_race$abortion_margin, 
        ohio_joined_race$weed_margin, 
        weight = ohio_joined_race$registered_voters)
```

